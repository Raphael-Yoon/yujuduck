import{GAME_CONSTANTS,GAME_STATES,MESSAGES}from"./constants.js";import{DollManager}from"./dollManager.js";export class GameEngine{constructor(t,e){this.canvas=t,this.ctx=e,this.dollManager=new DollManager,this.gameState=GAME_STATES.LOADING,this.coins=GAME_CONSTANTS.INITIAL_COINS,this.collectedDolls=new Set,this.hasBeggedForMoney=!1,this.claw={x:t.width/2,y:GAME_CONSTANTS.CLAW.INITIAL_Y,width:GAME_CONSTANTS.CLAW.WIDTH,height:GAME_CONSTANTS.CLAW.HEIGHT,speed:GAME_CONSTANTS.CLAW.SPEED,isClosed:!1,grabbedDoll:null,isShaking:!1},this.images={background:null,clawOpen:null,clawClosed:null,prize:null},this.prizeChuteX=GAME_CONSTANTS.PRIZE_CHUTE.X,this.prizeChuteWidth=GAME_CONSTANTS.PRIZE_CHUTE.WIDTH}async initialize(){await this.dollManager.loadDollData(),await this.loadGameImages(),await this.dollManager.loadImages(()=>{this.dollManager.createDolls(this.canvas.width,this.canvas.height,{x:this.prizeChuteX,y:this.canvas.height-200,width:300,height:200}),this.gameState=GAME_STATES.READY})}async loadGameImages(){return new Promise(t=>{let e=0;Object.entries({background:"images/background.jpg",clawOpen:"images/catch_o.png",clawClosed:"images/catch_c.png",prize:"images/prize.png"}).forEach(([a,s])=>{const i=new Image;i.src=s,i.onload=()=>{e++,4===e&&t()},i.onerror=()=>{console.warn(`Failed to load image: ${s}`),e++,4===e&&t()},this.images[a]=i})})}canPlay(){return this.coins>=GAME_CONSTANTS.GAME_COST}deductCoins(){this.coins-=GAME_CONSTANTS.GAME_COST}addCoins(t){this.coins+=t}getCoins(){return this.coins}getGameState(){return this.gameState}setGameState(t){this.gameState=t}getClaw(){return this.claw}getDolls(){return this.dollManager.getDolls()}getImages(){return this.images}getDollImage(t){return this.dollManager.getDollImage(t)}collectDoll(t){this.collectedDolls.add(t)}getCollectedDolls(){return this.collectedDolls}hasBegged(){return this.hasBeggedForMoney}setBeggedForMoney(){this.hasBeggedForMoney=!0}getRandomTauntMessage(){const t=MESSAGES.TAUNT;return t[Math.floor(Math.random()*t.length)]}getRandomCelebrationMessage(t){const e=MESSAGES.CELEBRATION;return e[Math.floor(Math.random()*e.length)].replace("${dollName}",t)}moveClawLeft(){this.gameState===GAME_STATES.READY&&(this.claw.x=Math.max(0,this.claw.x-20))}moveClawRight(){this.gameState===GAME_STATES.READY&&(this.claw.x=Math.min(this.canvas.width-this.claw.width,this.claw.x+20))}reset(){this.gameState=GAME_STATES.READY,this.claw.x=this.canvas.width/2,this.claw.y=GAME_CONSTANTS.CLAW.INITIAL_Y,this.claw.isClosed=!1,this.claw.grabbedDoll=null,this.claw.isShaking=!1,this.collectedDolls.clear(),this.hasBeggedForMoney=!1,this.coins=GAME_CONSTANTS.INITIAL_COINS,this.dollManager.createDolls(this.canvas.width,this.canvas.height,{x:this.prizeChuteX,y:this.canvas.height-200,width:300,height:200})}}